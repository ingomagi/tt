<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Fishing Made Easy</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="style.css" />
</head>
<body>

<div class="monitor-box" id="draggableWindow">
  <div class="monitor-header" id="monitorHeader">
    🎣 Fishing Made Easy
    <button id="open-settings" class="settings-btn">⚙️ Settings</button>
  </div>
  <div class="monitor-status">
    <div id="status-inv">📦 Inventory: -- / -- (--%)</div>
    <div id="status-trunk">🚚 Trunk: -- / -- (--%)</div>
    <div id="status-fish">🐟 Fish Meat: 0</div>
    <pre id="log">Waiting for updates...</pre>
  </div>
</div>

<div id="settings-panel" class="hidden">
  <h3>⚙️ Settings</h3>

  <label for="knife-select">Preferred Gut Knife:</label>
  <select id="knife-select">
    <option value="">-- Select Knife --</option>
    <option value="gut_knife">Gut Knife</option>
    <option value="gut_knife_st">☆ StatTrak™ Gut Knife</option>
    <option value="gut_knife_fade">☆ StatTrak™ Gut Knife | Autotronic</option>
    <option value="gut_knife_tiger">☆ StatTrak™ Gut Knife | Tiger Tooth</option>
    <option value="gut_knife_lore">☆ StatTrak™ Gut Knife | Weightless</option>
  </select>

  <label><input type="checkbox" id="toggle-logging" /> Enable Log (DEBUG)</label>
  <label><input type="checkbox" id="toggle-crabmode" /> Enable Crab Pot Mode 🦀</label>
  <label><input type="checkbox" id="toggle-trunkwarn" /> Enable Trunk Space Warning 🚨</label>
</div>

<style>
  #settings-panel input[type="checkbox"] {
    accent-color: #4caf50;
  }

  #settings-panel {
    position: absolute;
    top: 100px;
    right: 20px;
    background: #1e1e1e;
    color: white;
    padding: 10px 14px;
    border-radius: 8px;
    width: 260px;
    font-family: sans-serif;
    z-index: 1000;
    box-shadow: 0 0 10px #000;
  }

  #settings-panel.hidden {
    display: none;
  }

  #settings-panel h3 {
    margin-top: 0;
    font-size: 16px;
  }

  #settings-panel label {
    display: block;
    margin: 8px 0 4px;
  }

  #knife-select {
    width: 100%;
    margin-bottom: 10px;
    padding: 6px 8px;
    border: 1px solid #555;
    background-color: #2b2b2b;
    color: #fff;
    border-radius: 4px;
    font-family: inherit;
    font-size: 14px;
    appearance: none;
    background-image: url('data:image/svg+xml;utf8,<svg fill="white" height="10" viewBox="0 0 20 20" width="10" xmlns="http://www.w3.org/2000/svg"><polygon points="0,0 20,0 10,10"/></svg>');
    background-repeat: no-repeat;
    background-position: right 8px center;
    background-size: 10px;
    padding-right: 24px;
  }

  #knife-select:focus {
    outline: none;
    border-color: #888;
  }
</style>

<script>
  const settingsPanel = document.getElementById("settings-panel");
  const knifeSelect = document.getElementById("knife-select");
  const toggleLogCheckbox = document.getElementById("toggle-logging");
  const toggleCrabCheckbox = document.getElementById("toggle-crabmode");
  const toggleTrunkWarnCheckbox = document.getElementById("toggle-trunkwarn");

  document.getElementById("open-settings").onclick = () => {
    settingsPanel.classList.toggle("hidden");
  };

  knifeSelect.value = localStorage.getItem("gutKnife") || "";
  toggleLogCheckbox.checked = localStorage.getItem("enableLog") !== "false";
  toggleCrabCheckbox.checked = localStorage.getItem("crabMode") === "true";
  toggleTrunkWarnCheckbox.checked = localStorage.getItem("enableTrunkWarn") !== "false";

  knifeSelect.addEventListener("change", () => {
    localStorage.setItem("gutKnife", knifeSelect.value);
  });
  toggleLogCheckbox.addEventListener("change", () => {
    localStorage.setItem("enableLog", toggleLogCheckbox.checked);
    updateLogVisibility();
  });
  toggleCrabCheckbox.addEventListener("change", () => {
    localStorage.setItem("crabMode", toggleCrabCheckbox.checked);
  });
  toggleTrunkWarnCheckbox.addEventListener("change", () => {
    localStorage.setItem("enableTrunkWarn", toggleTrunkWarnCheckbox.checked);
  });
</script>

<script type="module" src="monitor.js"></script>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const dragEl = document.getElementById("draggableWindow");
    const headerEl = document.getElementById("monitorHeader");
    let isDragging = false, offsetX = 0, offsetY = 0;

    const savedX = localStorage.getItem("uiPosX");
    const savedY = localStorage.getItem("uiPosY");
    if (savedX && savedY) {
      dragEl.style.left = savedX + "px";
      dragEl.style.top = savedY + "px";
    }

    headerEl.addEventListener("mousedown", (e) => {
      isDragging = true;
      offsetX = e.clientX - dragEl.offsetLeft;
      offsetY = e.clientY - dragEl.offsetTop;
    });

    document.addEventListener("mouseup", () => {
      if (isDragging) {
        localStorage.setItem("uiPosX", dragEl.offsetLeft);
        localStorage.setItem("uiPosY", dragEl.offsetTop);
      }
      isDragging = false;
    });

    document.addEventListener("mousemove", (e) => {
      if (!isDragging) return;
      dragEl.style.left = `${e.clientX - offsetX}px`;
      dragEl.style.top = `${e.clientY - offsetY}px`;
    });
  });
</script>

<script>
  window.addEventListener("keydown", (e) => {
    if (e.key === "Escape") {
      const panel = document.getElementById("settings-panel");
      if (!panel.classList.contains("hidden")) {
        panel.classList.add("hidden");
      } else {
        window.parent.postMessage({ type: "pin" }, "*");
      }
    }
  });

  function updateLogVisibility() {
    const logBox = document.getElementById("log");
    const enabled = localStorage.getItem("enableLog") === "true";
    logBox.style.display = enabled ? "block" : "none";
  }

  document.addEventListener("DOMContentLoaded", () => {
    updateLogVisibility();
  });
</script>
</body>
</html>
